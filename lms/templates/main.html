## coding=utf-8

## This is the main Mako template that all page templates should include.
## Note: there are a handful of pages that use Django Templates and which
## instead include main_django.html. It is important that these two files
## remain in sync, so changes made in one should be applied to the other.

## Pages currently use v1 styling by default. Once the Pattern Library
## rollout has been completed, this default can be switched to v2.
<%! main_css = "style-main-v1" %>


<%namespace name='static' file='static_content.html'/>
<% online_help_token = self.online_help_token() if hasattr(self, 'online_help_token') else None %>
<%!
from django.core.urlresolvers import reverse
from django.utils.http import urlquote_plus
from django.utils.translation import ugettext as _
from django.utils.translation import get_language_bidi
from branding import api as branding_api
from pipeline_mako import render_require_js_path_overrides
%>
<!DOCTYPE html>
<!--[if lte IE 9]><html class="ie ie9 lte9" lang="${LANGUAGE_CODE}"><![endif]-->
<!--[if !IE]><!--><html lang="${LANGUAGE_CODE}"><!--<![endif]-->
<head dir="${static.dir_rtl()}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

## Define a couple of helper functions to make life easier when
## embedding theme conditionals into templates. All inheriting
## templates have access to these functions, and we can import these
## into non-inheriting templates via the %namespace tag.

## this needs to be here to prevent the title from mysteriously appearing in the body, in one case
<%def name="pagetitle()" />
  <%block name="title">
      <title>
       ${static.get_page_title_breadcrumbs(self.pagetitle())}
      </title>
  </%block>

  % if not allow_iframing:
      <script type="text/javascript">
        /* immediately break out of an iframe if coming from the marketing website */
        (function(window) {
          if (window.location !== window.top.location) {
            window.top.location = window.location;
          }
        })(this);
      </script>
  % endif

  <%
    jsi18n_path = "js/i18n/{language}/djangojs.js".format(language=LANGUAGE_CODE)
  %>

  <script type="text/javascript" src="${static.url(jsi18n_path)}"></script>

  <link rel="icon" type="image/x-icon" href="${static.url(static.get_value('favicon_path', settings.FAVICON_PATH))}" />

  <%static:css group='style-vendor'/>
  <%static:css group='${self.attr.main_css}'/>

  % if not uses_pattern_library:
    % if disable_courseware_js:
      <%static:js group='base_vendor'/>
      <%static:js group='base_application'/>
    % else:
      <%static:js group='main_vendor'/>
      <%static:js group='application'/>
    % endif
  % else:
    ## TODO: Update to only bring in RequireJS
    ## https://openedx.atlassian.net/browse/FEDX-140
    <%static:js group='base_vendor'/>
    <%static:js group='base_application'/>
  % endif

  <script>
    window.baseUrl = "${settings.STATIC_URL}";
    (function (require) {
      require.config({
          baseUrl: window.baseUrl
      });
    }).call(this, require || RequireJS.require);
  </script>
  <script type="text/javascript" src="${static.url("lms/js/require-config.js")}"></script>
  <%block name="js_overrides">
    ${render_require_js_path_overrides(settings.REQUIRE_JS_PATH_OVERRIDES)}
  </%block>

  % if not disable_courseware_js:
    <%static:js group='module-js'/>
  % endif

  <%block name="headextra"/>

  <%static:optional_include_mako file="head-extra.html" is_theming_enabled="True" />

  <%include file="widgets/optimizely.html" />
  <%include file="widgets/segment-io.html" />

  <meta name="path_prefix" content="${EDX_ROOT_URL}">
  <meta name="google-site-verification" content="_mipQ4AtZQDNmbtOkwehQDOgCxUUV2fb_C0b6wbiRHY" />

<% ga_acct = static.get_value("GOOGLE_ANALYTICS_ACCOUNT", settings.GOOGLE_ANALYTICS_ACCOUNT) %>
% if ga_acct:
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '${ga_acct}']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
% endif

</head>

<body class="${static.dir_rtl()} <%block name='bodyclass'/> lang_${LANGUAGE_CODE}">
<svg style="display:none;">
    <symbol viewBox="0 0 16 17" id="calendar">
        <path d="M13.571,1.076v12.308c0,0.333-0.122,0.622-0.366,0.866c-0.243,0.244-0.531,0.365-0.864,0.365H-1.198
        c-0.333,0-0.622-0.122-0.866-0.366s-0.365-0.531-0.365-0.864V1.076c0-0.333,0.122-0.622,0.365-0.866s0.533-0.365,0.866-0.365h1.231
        v-0.923c0-0.422,0.151-0.785,0.451-1.087c0.303-0.3,0.665-0.451,1.088-0.451h0.616c0.422,0,0.785,0.151,1.087,0.451
        c0.3,0.302,0.451,0.663,0.451,1.087v0.923h3.692v-0.923c0-0.422,0.151-0.785,0.452-1.087c0.302-0.3,0.663-0.451,1.087-0.451h0.615
        c0.424,0,0.785,0.151,1.087,0.451c0.302,0.302,0.452,0.663,0.452,1.087v0.923h1.231c0.333,0,0.622,0.122,0.866,0.365
        C13.449,0.455,13.571,0.743,13.571,1.076z M-1.198,13.385h13.539V3.539H-1.198V13.385z M2.495,1.692v-2.77
        c0-0.09-0.029-0.164-0.088-0.221C2.35-1.357,2.277-1.386,2.186-1.386H1.572c-0.09,0-0.164,0.029-0.221,0.088
        C1.292-1.241,1.263-1.168,1.263-1.077v2.77c0,0.09,0.029,0.164,0.088,0.221c0.057,0.059,0.131,0.088,0.221,0.088h0.616
        c0.09,0,0.164-0.029,0.221-0.088C2.466,1.856,2.495,1.781,2.495,1.692z M8.254,10.703l-0.442,0.442
        c-0.059,0.057-0.128,0.088-0.211,0.088c-0.083,0-0.158-0.03-0.221-0.088L5.571,9.327l-1.806,1.818
        c-0.065,0.057-0.138,0.088-0.221,0.088c-0.083,0-0.154-0.03-0.211-0.088l-0.444-0.442c-0.057-0.057-0.086-0.129-0.086-0.211
        s0.029-0.157,0.086-0.221l1.818-1.808L2.889,6.653C2.831,6.59,2.802,6.515,2.802,6.432c0-0.083,0.029-0.154,0.086-0.211
        l0.442-0.442c0.057-0.057,0.128-0.086,0.211-0.086c0.083,0,0.157,0.029,0.221,0.086l1.808,1.808l1.808-1.808
        C7.442,5.721,7.516,5.693,7.6,5.693c0.083,0,0.154,0.029,0.211,0.086l0.444,0.442c0.057,0.057,0.086,0.128,0.086,0.211
        c0,0.083-0.029,0.158-0.086,0.221L6.447,8.461l1.808,1.808c0.057,0.065,0.086,0.139,0.086,0.221S8.312,10.645,8.254,10.703z
         M9.878,1.692v-2.77c0-0.09-0.029-0.164-0.086-0.221C9.735-1.357,9.66-1.386,9.571-1.386H8.957c-0.09,0-0.164,0.029-0.221,0.088
        C8.678-1.241,8.649-1.168,8.649-1.077v2.77c0,0.09,0.029,0.164,0.086,0.221c0.059,0.059,0.132,0.088,0.221,0.088h0.615
        c0.09,0,0.164-0.029,0.221-0.088C9.85,1.856,9.878,1.781,9.878,1.692z"/>
    </symbol>
    <symbol viewBox="0 0 15 16" id="calendar_check">
      <path d="M13.071,1.384v11.538c0,0.312-0.114,0.583-0.343,0.812c-0.227,0.229-0.498,0.343-0.81,0.343H-0.775
      c-0.312,0-0.583-0.114-0.812-0.342c-0.227-0.229-0.342-0.499-0.342-0.812V1.384c0-0.312,0.114-0.583,0.342-0.812
      S-1.087,0.23-0.775,0.23h1.154v-0.866c0-0.396,0.141-0.736,0.423-1.019c0.284-0.281,0.623-0.423,1.02-0.423h0.577
      c0.396,0,0.736,0.141,1.019,0.423C3.7-1.371,3.841-1.032,3.841-0.635V0.23h3.461v-0.866c0-0.396,0.141-0.736,0.424-1.019
      c0.283-0.281,0.622-0.423,1.019-0.423h0.576c0.397,0,0.736,0.141,1.019,0.423c0.283,0.283,0.424,0.622,0.424,1.019V0.23h1.154
      c0.312,0,0.583,0.114,0.812,0.342C12.957,0.801,13.071,1.072,13.071,1.384z M-0.775,12.923h12.693v-9.23H-0.775V12.923z
       M2.687,1.962v-2.597c0-0.085-0.027-0.153-0.082-0.207C2.551-0.898,2.483-0.925,2.398-0.925H1.822
      c-0.085,0-0.153,0.027-0.207,0.082C1.559-0.789,1.532-0.72,1.532-0.635v2.597c0,0.085,0.027,0.153,0.082,0.207
      c0.054,0.055,0.122,0.082,0.207,0.082h0.577c0.085,0,0.153-0.027,0.207-0.082C2.66,2.115,2.687,2.046,2.687,1.962z M9.818,6.612
      l-4.616,4.616c-0.061,0.054-0.129,0.082-0.207,0.082c-0.078,0-0.148-0.028-0.207-0.082L2.191,8.632
      C2.137,8.572,2.11,8.502,2.11,8.424c0-0.078,0.027-0.144,0.081-0.198l0.415-0.415c0.055-0.054,0.12-0.081,0.198-0.081
      S2.95,7.758,3.01,7.812l1.984,1.984l4.002-4.003c0.059-0.054,0.129-0.081,0.207-0.081c0.078,0,0.144,0.027,0.198,0.081l0.415,0.415
      c0.054,0.055,0.081,0.12,0.081,0.198S9.872,6.553,9.818,6.612z M9.609,1.962v-2.597c0-0.085-0.027-0.153-0.081-0.207
      C9.475-0.898,9.405-0.925,9.321-0.925H8.745c-0.085,0-0.153,0.027-0.207,0.082C8.484-0.789,8.457-0.72,8.457-0.635v2.597
      c0,0.085,0.027,0.153,0.081,0.207c0.055,0.055,0.124,0.082,0.207,0.082h0.576c0.085,0,0.153-0.027,0.207-0.082
      C9.582,2.115,9.609,2.046,9.609,1.962z"/>
    </symbol>
    <symbol viewBox="0 0 15 16" id="clock">
      <path d="M12.071,1.128c0.714,1.226,1.072,2.564,1.072,4.015c0,1.453-0.358,2.791-1.072,4.017c-0.716,1.226-1.686,2.195-2.912,2.911
      c-1.226,0.716-2.564,1.072-4.015,1.072s-2.791-0.356-4.017-1.072c-1.226-0.716-2.197-1.685-2.911-2.911
      C-2.5,7.934-2.858,6.595-2.858,5.143S-2.5,2.354-1.784,1.128c0.714-1.226,1.685-2.197,2.912-2.912
      c1.224-0.717,2.564-1.073,4.015-1.073s2.789,0.356,4.015,1.072S11.355-0.099,12.071,1.128z M10.05,7.987
      c0.507-0.868,0.761-1.815,0.761-2.844c0-1.027-0.254-1.976-0.761-2.844S8.855,0.744,7.987,0.237
      C7.119-0.27,6.172-0.524,5.143-0.524S3.166-0.27,2.3,0.235C1.431,0.742,0.744,1.431,0.237,2.298
      c-0.507,0.87-0.761,1.817-0.761,2.845s0.254,1.977,0.761,2.844C0.744,8.857,1.431,9.543,2.3,10.05s1.815,0.759,2.844,0.759
      s1.976-0.252,2.844-0.759C8.855,9.543,9.543,8.855,10.05,7.987z M6.476,1.475v4.667c0,0.098-0.031,0.177-0.093,0.24
      C6.319,6.444,6.24,6.476,6.144,6.476H2.81c-0.098,0-0.177-0.033-0.24-0.095S2.477,6.24,2.477,6.142V5.476
      c0-0.098,0.031-0.177,0.093-0.24s0.142-0.093,0.24-0.093h2.333V1.475c0-0.096,0.031-0.176,0.093-0.238
      c0.062-0.062,0.142-0.095,0.24-0.095h0.667c0.098,0,0.177,0.033,0.24,0.095C6.445,1.299,6.476,1.38,6.476,1.475z"/>
    </symbol>
    <symbol viewBox="0 0 22 14" id="money">
      <path d="M22.418,0.747v13.451c0,0.203-0.075,0.378-0.223,0.524c-0.146,0.148-0.322,0.223-0.524,0.223H0.747
      c-0.203,0-0.378-0.075-0.525-0.223C0.074,14.576,0,14.401,0,14.198V0.747c0-0.202,0.074-0.377,0.222-0.525
      C0.369,0.074,0.545,0,0.747,0H21.67c0.203,0,0.378,0.074,0.524,0.221C22.343,0.369,22.418,0.545,22.418,0.747z M20.923,10.462
      V4.483c-0.826,0-1.529-0.292-2.113-0.876c-0.584-0.583-0.875-1.288-0.875-2.113H4.483c0,0.825-0.291,1.53-0.875,2.113
      C3.024,4.191,2.319,4.483,1.495,4.483v5.979c0.824,0,1.529,0.291,2.113,0.875s0.875,1.289,0.875,2.113h13.451
      c0-0.824,0.291-1.529,0.875-2.113S20.097,10.462,20.923,10.462z M14.7,5.814c0.163,0.561,0.245,1.114,0.245,1.658
      S14.863,8.57,14.7,9.13c-0.163,0.561-0.395,1.082-0.695,1.566c-0.3,0.482-0.695,0.875-1.185,1.178
      c-0.49,0.305-1.027,0.456-1.611,0.456s-1.12-0.152-1.611-0.456c-0.49-0.303-0.887-0.696-1.185-1.178
      c-0.3-0.484-0.531-1.005-0.695-1.566C7.555,8.57,7.473,8.017,7.473,7.472s0.082-1.097,0.245-1.658
      c0.163-0.56,0.395-1.081,0.695-1.564c0.298-0.483,0.695-0.876,1.185-1.179c0.49-0.304,1.027-0.455,1.611-0.455
      s1.12,0.152,1.611,0.455c0.49,0.303,0.885,0.696,1.185,1.179C14.305,4.733,14.536,5.254,14.7,5.814z M8.967,10.462h4.483V9.34
      h-1.493V4.11h-1.332l-1.728,1.6l0.899,0.934c0.327-0.288,0.541-0.51,0.642-0.666h0.024V9.34H8.967V10.462z"/>
    </symbol>
</svg>

<%static:optional_include_mako file="body-initial.html" is_theming_enabled="True" />
<div id="page-prompt"></div>
% if not disable_window_wrap:
  <div class="window-wrap" dir="${static.dir_rtl()}">
% endif
    <a class="nav-skip" href="#main">${_("Skip to main content")}</a>

    % if not disable_header:
        <%include file="${static.get_template_path('header.html')}" args="online_help_token=online_help_token" />
    % endif

    <div class="content-wrapper" id="content">
      ${self.body()}
      <%block name="bodyextra"/>
    </div>

    % if not disable_footer:
        <%include file="themable-footer.html" />
    % endif

% if not disable_window_wrap:
  </div>
% endif

  <%block name="js_extra"/>

  <%include file="widgets/segment-io-footer.html" />
  <script type="text/javascript" src="${static.url('js/vendor/noreferrer.js')}" charset="utf-8"></script>
  <script type="text/javascript" src="${static.url('js/utils/navigation.js')}" charset="utf-8"></script>
  <%static:optional_include_mako file="body-extra.html" is_theming_enabled="True" />
</body>
</html>

<%def name="login_query()">${
  u"?next={0}".format(urlquote_plus(login_redirect_url)) if login_redirect_url else ""
}</%def>

<!-- Performance beacon for onload times -->
% if settings.FEATURES.get('ENABLE_ONLOAD_BEACON', False):
<script>
  (function () {
    var sample_rate = ${settings.ONLOAD_BEACON_SAMPLE_RATE};
    var roll = Math.floor(Math.random() * 100)/100;
    var onloadBeaconSent = false;

    if(roll < sample_rate){
      $(window).load(function() {
        setTimeout(function(){
          var t = window.performance.timing;

          var data = {
            event: "onload",
            value: t.loadEventEnd - t.navigationStart,
            page: window.location.href,
          };

          if (!onloadBeaconSent) {
            $.ajax({method: "POST", url: "/performance", data: data});
          }
          onloadBeaconSent = true;
        }, 0);
      });
    }
  }());
</script>
% endif
